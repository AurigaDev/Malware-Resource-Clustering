import os,cPickle as pickle,sys
from scrape import Resource
from collections import Counter
import time

import numpy as np

File_Count = {}
Reg_Count = {}
Mux_Count = {}
Res_Count = [File_Count, Reg_Count, Mux_Count]

malware_files = []
malware_class = []
malware_names = []
for root, dirs, files in os.walk("Data/"):
	for file in files:
		file = os.path.join(root, file)
		resources = pickle.load(open(file,"rb"))
		for i in range(0,3):
			if i == 0:
				malware_files.append(resources.resources[i])
				malware_names.append(resources.name)
				if resources.avr <0:
					malware_class.append(0)
				else:
					malware_class.append(resources.avr)

#r = len(files)
r = 499
x = 0
y = 0

dis_mat = np.zeros((r, r))

# Substring Sieve
for i in range(0,r):
	malware_files[i].sort(key = lambda s: len(s))
	out = []
	for s in malware_files[i]:
		if not any([s in o for o in out]):
			out.append(s)
	malware_files[i] = out

for x in range(0, r):
	for y in range(0, r):
		dis_mat[x,y] = len(list(set(malware_files[x])^(set(malware_files[y]))))

pickle.dump( dis_mat, open( "matrixbin", "wb" ) )
pickle.dump( malware_class, open( "malwareclass", "wb" ) )

print "https://malwr.com"+pickle.load(open("links","rb"))[35]
print "https://malwr.com"+pickle.load(open("links","rb"))[489]